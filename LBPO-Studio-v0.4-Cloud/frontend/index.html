<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>LBPO‑Studio v0.4 · Frontend</title>
<!--
Title: LBPO‑Studio v0.4 · Frontend
Description: Fetches /api/optimize from backend and renders charts.
-->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
:root{--bg:#0b1020;--text:#e7ecff;--muted:#9fb0ff}
*{box-sizing:border-box}body{margin:0;background:#0b1020;color:var(--text);font-family:Inter}
.wrap{max-width:1100px;margin:0 auto;padding:28px}
.card{background:#111831;border:1px solid #243063;border-radius:18px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
.pad{padding:18px}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.grid3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:16px}
input,textarea,select,button{border-radius:12px;border:1px solid #243063;background:#0b1233;color:var(--text);padding:10px;width:100%}
button{cursor:pointer;background:linear-gradient(180deg,#1e3a8a,#1f51a3);font-weight:800}
.kpis{display:grid;grid-template-columns:repeat(5,1fr);gap:12px}
.kpi{border-radius:16px;border:1px solid #273167;background:#0c1333;padding:14px}
.kpi .v{font-size:26px;font-weight:800}
</style>
</head>
<body>
<div class="wrap">
  <h2>LBPO‑Studio v0.4 · Frontend</h2>
  <div class="grid2">
    <div class="card pad">
      <h3>Task</h3>
      <textarea id="task" rows="5" placeholder="e.g., Classify sentiment of a sentence; output POS or NEG only."></textarea>
      <h3 style="margin-top:12px">Examples (optional)</h3>
      <textarea id="examples" rows="4" placeholder="POS || I love this!&#10;NEG || This is terrible."></textarea>
      <div style="display:flex;gap:10px;margin-top:12px">
        <input id="api" placeholder="Backend URL, e.g., https://your-backend.onrender.com">
        <button id="run">▶ Run</button>
      </div>
    </div>
    <div class="card pad">
      <h3>Best Prompt</h3>
      <textarea id="best" rows="11" readonly></textarea>
    </div>
  </div>

  <div class="kpis" style="margin-top:16px">
    <div class="kpi"><div>Accuracy</div><div id="acc" class="v">—</div></div>
    <div class="kpi"><div>F1</div><div id="f1" class="v">—</div></div>
    <div class="kpi"><div>Pass Rate</div><div id="pass" class="v">—</div></div>
    <div class="kpi"><div>Token Cost ↓</div><div id="cost" class="v">—</div></div>
    <div class="kpi"><div>Progress %</div><div id="prog" class="v">—</div></div>
  </div>

  <div class="grid2" style="margin-top:16px">
    <div class="card pad"><h3>Growth Over Iterations</h3><canvas id="line" height="160"></canvas></div>
    <div class="card pad"><h3>Change Contribution</h3><canvas id="bar" height="160"></canvas></div>
  </div>

  <div class="grid3" style="margin-top:16px">
    <div class="card pad"><h3>Pass vs Fail (%)</h3><canvas id="pie" height="140"></canvas></div>
    <div class="card pad"><h3>Progress Meter (%)</h3><canvas id="gauge" height="140"></canvas></div>
    <div class="card pad"><h3>Prompt Versions</h3><div id="versions" style="white-space:pre-wrap;font-size:12px;color:#9fb0ff"></div></div>
  </div>
</div>

<script>
const lineChart=new Chart(document.getElementById("line"),{type:"line",data:{labels:[],datasets:[{label:"Accuracy",data:[],borderWidth:3,tension:.35}]},options:{plugins:{legend:{display:false}},scales:{y:{min:0,max:100,ticks:{callback:v=>v+"%"}}}});
const barChart=new Chart(document.getElementById("bar"),{type:"bar",data:{labels:[],datasets:[{label:"Δ Accuracy",data:[]}]},options:{plugins:{legend:{display:false}},scales:{y:{ticks:{callback:v=>v+"%"}}}});
const pieChart=new Chart(document.getElementById("pie"),{type:"doughnut",data:{labels:["Pass","Fail"],datasets:[{data:[0,100]}]},options:{plugins:{legend:{position:"bottom"}}}});
const gaugeChart=new Chart(document.getElementById("gauge"),{type:"doughnut",data:{labels:["Progress","Remaining"],datasets:[{data:[0,100],cutout:"75%"}]},options:{plugins:{legend:{display:false}}}});

run.addEventListener("click", async ()=>{
  const url = (api.value || "").trim().replace(/\/$/, "");
  if(!url){ alert("Please enter backend URL."); return; }
  const body = { task: task.value, examples: examples.value };
  const r = await fetch(url + "/api/optimize", {
    method:"POST", headers:{ "Content-Type":"application/json" }, body: JSON.stringify(body)
  });
  if(!r.ok){ alert("Backend error."); return; }
  const data = await r.json();
  acc.textContent = data.acc + "%"; f1.textContent = data.f1 + "%"; pass.textContent = data.pass + "%"; cost.textContent = data.cost + "%"; prog.textContent = data.progress + "%";
  lineChart.data.labels = data.labels; lineChart.data.datasets[0].data = data.series; lineChart.update();
  barChart.data.labels = data.barsL; barChart.data.datasets[0].data = data.barsV; barChart.update();
  pieChart.data.datasets[0].data = [data.pass, 100-data.pass]; pieChart.update();
  gaugeChart.data.datasets[0].data = [data.acc, 100-data.acc]; gaugeChart.update();
  best.value = data.best; versions.textContent = data.versions;
});
</script>
</body>
</html>
